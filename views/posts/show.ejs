<%- layout("layouts/body.ejs") %>

<div class="show-selected-post h-100 w-100">
  <div id="carouselExample" class="carousel slide rounded-2">
    <div class="carousel-inner">
      <% for (let i=0; i<user.posts.length; i++) { %>
        <div class="w-100 <%= user.posts[i]._id.equals(id) ? " carousel-item active" :"carousel-item" %>">
          <div class="d-flex flex-column align-items-center">
            <img src="<%= user.posts[i].image %>" class="" alt="SelectedPost" />
            <div class="comment-section">
              <div class="card border-secondary">
                <div class="card-header bg-transparent border-secondary py-3 d-flex justify-content-between">
                  <span class="commenting-user"><%= user.username %></span>

                  <div class="dropdown">
                    <span role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fa-solid fa-ellipsis ms-auto"></i>
                    </span>
                    <ul class="dropdown-menu">
                      <% if(currentUser && user._id.equals(currentUser._id)) { %>
                        <li><a class="dropdown-item" href="/posts/<%= user.posts[i]._id %>/edit">Edit</a></li>
                        <li><form action="/posts/<%= user.posts[i]._id %>?_method=DELETE" method="post" class="p-0 dropdown-item">
                          <button class="btn text-danger">Delete</button>
                        </form></li>
                        <% } %>
                        <li><a class="dropdown-item" href="/user/<%= user._id %>">All Posts</a></li>
                    </ul>
                  </div>
                </div>
                <div class="card-body">
                  <p class="card-text px-3">
                    <span class="me-2 commenting-user"><%= user.username %></span>
                    <span class="commenting-value"><%= user.posts[i].caption %></span>
                  </p>
                  <% for (let comment of user.posts[i].comments){ %>
                    <p class="card-text px-3">
                      <a href="/user/<%= comment.author._id %>" class="me-2 commenting-user"><%= comment.author.username %></a>
                      <span class="commenting-value"><%= comment.comment %></span>
                    </p>
                  <% } %>
                </div>
                <div class="card-footer new-comment-div bg-transparent border-secondary">
                  <form action="/posts/<%= user.posts[i]._id %>/comments" method="post">
                    <textarea
                      name="comment"
                      id="comment"
                      placeholder="Add a comment..."
                    ></textarea>
                    <button class="btn text-primary ms-3">Post</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% } %>
        
        <button
          class="carousel-control-prev slide-btn"
          type="button"
          data-bs-target="#carouselExample"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next slide-btn"
          type="button"
          data-bs-target="#carouselExample"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
    </div>
  </div>
</div>
